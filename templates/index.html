<!DOCTYPE html>
<html>
<head>
  <title>Food Munch - Restaurant</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/d1c2ea8b80.js" crossorigin="anonymous"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap");
    
    * { font-family: 'Roboto', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #f5f7fa; }
    
    .food-munch-logo { width: 80px; }
    
    .banner-section-bg-container {
      background-image: url("https://d2clawv67efefq.cloudfront.net/ccbp-responsive-website/foodmunch-banner-bg.png");
      height: 60vh;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .custom-button {
      background-color: #d0b200;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      margin: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .custom-button:hover {
      background-color: #b89f00;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(208,178,0,0.4);
    }
    
    .login-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .login-dropdown-content {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 220px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1000;
      border-radius: 8px;
      right: 0;
      top: 100%;
      margin-top: 5px;
    }
    
    .login-dropdown-content a {
      color: #333;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      transition: all 0.3s;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .login-dropdown-content a:hover {
      background-color: #f1f1f1;
    }
    
    .login-dropdown:hover .login-dropdown-content {
      display: block;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background: white;
      border-radius: 8px;
      margin-left: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .user-info i {
      font-size: 24px;
      color: #d0b200;
      margin-right: 10px;
    }
    
    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 10px;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background: #c82333;
    }
    
    .category-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s;
      cursor: pointer;
      height: 100%;
      overflow: hidden;
    }
    
    .category-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .category-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    
    .menu-item-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .menu-item-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .menu-item-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    
    .price-tag {
      color: #d0b200;
      font-size: 20px;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .add-to-cart-btn {
      background-color: #d0b200;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .add-to-cart-btn:hover {
      background-color: #b89f00;
      transform: translateY(-2px);
    }
    
    .back-btn {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      margin-bottom: 20px;
    }
    
    .cart-icon {
      position: relative;
      cursor: pointer;
    }
    
    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: red;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    .modal-header {
      background: linear-gradient(135deg, #d0b200 0%, #b89f00 100%);
      color: white;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .quantity-btn {
      background: #d0b200;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 5px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    
    .order-history-item {
      border-left: 4px solid #d0b200;
      padding: 15px;
      margin-bottom: 15px;
      background: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .order-history-item.delivered {
      border-left-color: #28a745;
      background: #f8f9fa;
    }
    
    .status-badge {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      display: inline-block;
    }
    
    .status-pending { background: #ffc107; color: #000; }
    .status-assigned { background: #17a2b8; color: #fff; }
    .status-delivering { background: #fd7e14; color: #fff; }
    .status-delivered { background: #28a745; color: #fff; }
    
    .hidden { display: none; }
    
    .rating-stars {
      display: flex;
      gap: 10px;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
    }
    
    .rating-stars i {
      color: #d0b200;
      transition: all 0.2s;
    }
    
    .rating-stars i:hover {
      transform: scale(1.2);
    }
    
    .follow-us-section {
      background-color: #183b56;
    }
    
    .follow-us-icon-container {
      background-color: #5a7184;
      width: 80px;
      height: 80px;
      border-radius: 50px;
      margin: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s;
    }
    
    .follow-us-icon-container:hover {
      background-color: #d0b200;
      transform: scale(1.1);
    }
    
    .social-icon {
      color: white;
      font-size: 35px;
    }
    
    .footer-section {
      background-color: #0d2436;
      padding: 30px 0;
    }

    .delivery-timeline {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 13px;
    }

    .delivery-timeline div {
      padding: 5px 0;
    }

    .delivery-boy-info {
      background: #e7f3ff;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      border-left: 3px solid #17a2b8;
    }

    .empty-cart {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .empty-cart i {
      font-size: 64px;
      color: #ddd;
      margin-bottom: 20px;
    }

    .input-error {
      border-color: #dc3545 !important;
    }

    .error-message {
      color: #dc3545;
      font-size: 12px;
      margin-top: 5px;
    }

    .password-strength {
      height: 5px;
      border-radius: 3px;
      margin-top: 5px;
      transition: all 0.3s;
    }

    .strength-weak { background: #dc3545; width: 33%; }
    .strength-medium { background: #ffc107; width: 66%; }
    .strength-strong { background: #28a745; width: 100%; }
    
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .loading-spinner.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="#home">
        <img src="https://d2clawv67efefq.cloudfront.net/ccbp-responsive-website/food-munch-img.png" class="food-munch-logo" />
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto align-items-center">
          <li class="nav-item">
            <a class="nav-link" href="#home">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#menuSection">View Menu</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#followUsSection">Follow Us</a>
          </li>
          
          <!-- Guest View -->
          <li class="nav-item ml-3" id="guestView">
            <div class="login-dropdown">
              <button class="custom-button">
                <i class="fas fa-sign-in-alt"></i> Login
              </button>
              <div class="login-dropdown-content">
                <a onclick="showLoginModal('customer')">
                  <i class="fas fa-user"></i> Customer Login
                </a>
                <a onclick="showLoginModal('delivery')">
                  <i class="fas fa-motorcycle"></i> Delivery Boy Login
                </a>
                <a onclick="showLoginModal('admin')">
                  <i class="fas fa-user-shield"></i> Admin Login
                </a>
              </div>
            </div>
          </li>
          
          <!-- Logged In View -->
          <li class="nav-item" id="loggedInView" style="display: none;">
            <a class="nav-link" href="#" onclick="showMyOrders()">
              <i class="fas fa-history"></i> My Orders
            </a>
          </li>
          <li class="nav-item ml-3">
            <div class="cart-icon" onclick="openCart()">
              <i class="fas fa-shopping-cart fa-2x" style="color: #d0b200;"></i>
              <span class="cart-badge" id="cartCount">0</span>
            </div>
          </li>
          <li class="nav-item" id="userInfoView" style="display: none;">
            <div class="user-info">
              <i class="fas fa-user-circle"></i>
              <span id="userName"></span>
              <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Banner -->
  <div class="banner-section-bg-container" id="home">
    <div class="text-center text-white">
      <h1 style="font-size: 45px; font-weight: 300;">Get Delicious Food Anytime</h1>
      <p style="font-size: 24px; font-weight: 300;">Eat Smart & Healthy</p>
      <button class="custom-button" onclick="document.getElementById('menuSection').scrollIntoView({behavior: 'smooth'})">View Menu</button>
      <button class="custom-button" onclick="proceedToOrder()">Order Now</button>
    </div>
  </div>

  <!-- Menu Section -->
  <div class="pt-5 pb-5" id="menuSection">
    <div class="container">
      <h1 class="text-center mb-4" style="color: #183b56; font-size: 32px; font-weight: 700;">Our Menu</h1>
      
      <!-- Categories View -->
      <div id="categoriesView">
        <div class="row" id="menuCategories"></div>
      </div>
      
      <!-- Items View -->
      <div id="itemsView" class="hidden">
        <button class="back-btn" onclick="showCategories()">
          <i class="fas fa-arrow-left"></i> Back to Categories
        </button>
        <h2 class="mb-4" style="color: #183b56;" id="categoryTitle"></h2>
        <div class="row" id="menuItems"></div>
      </div>
    </div>
  </div>

  <!-- Feedback Section -->
  <div class="pt-5 pb-5" style="background-color: #f5f7fa;">
    <div class="container">
      <h1 class="text-center mb-4" style="color: #183b56; font-size: 32px; font-weight: 700;">Share Your Feedback</h1>
      <div class="row justify-content-center">
        <div class="col-md-6">
          <form id="feedbackForm">
            <div class="form-group">
              <input type="text" class="form-control" id="feedbackName" placeholder="Your Name" required>
            </div>
            <div class="form-group">
              <input type="email" class="form-control" id="feedbackEmail" placeholder="Your Email" required>
            </div>
            <div class="form-group">
              <label>Rating: <span id="ratingDisplay">0</span>/5</label>
              <div class="rating-stars" id="ratingStars">
                <i class="far fa-star" data-rating="1"></i>
                <i class="far fa-star" data-rating="2"></i>
                <i class="far fa-star" data-rating="3"></i>
                <i class="far fa-star" data-rating="4"></i>
                <i class="far fa-star" data-rating="5"></i>
              </div>
              <input type="hidden" id="feedbackRating" required>
            </div>
            <div class="form-group">
              <textarea class="form-control" id="feedbackComment" rows="4" placeholder="Your Comments" required></textarea>
            </div>
            <button type="submit" class="custom-button btn-block">Submit Feedback</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Follow Us Section -->
  <div class="follow-us-section pt-5 pb-5" id="followUsSection">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h1 class="text-center mb-4" style="color: white; font-size: 32px; font-weight: 700;">Follow Us</h1>
        </div>
        <div class="col-12">
          <div class="d-flex flex-row justify-content-center">
            <a href="https://twitter.com" target="_blank" class="follow-us-icon-container">
              <i class="fab fa-twitter social-icon"></i>
            </a>
            <a href="https://instagram.com" target="_blank" class="follow-us-icon-container">
              <i class="fab fa-instagram social-icon"></i>
            </a>
            <a href="https://facebook.com" target="_blank" class="follow-us-icon-container">
              <i class="fab fa-facebook social-icon"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer-section">
    <div class="container">
      <div class="row">
        <div class="col-12 text-center">
          <img src="https://d2clawv67efefq.cloudfront.net/ccbp-responsive-website/food-munch-logo-light.png" class="food-munch-logo mb-3" />
          <h5 style="color: #959ead; font-weight: bold;">orderfood@foodmunch.com</h5>
          <p style="color: #959ead;">123 Ayur Vigyan Nagar, New Delhi, India.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Login/Register Modal -->
  <div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModalTitle">Customer Login</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Login Form -->
          <div id="loginFormDiv">
            <form id="loginForm">
              <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email</label>
                <input type="email" class="form-control" id="loginEmail" required>
                <div class="error-message" id="loginEmailError"></div>
              </div>
              <div class="form-group">
                <label><i class="fas fa-lock"></i> Password</label>
                <input type="password" class="form-control" id="loginPassword" required>
                <div class="error-message" id="loginPasswordError"></div>
              </div>
              <button type="submit" class="custom-button btn-block">Login</button>
              <div class="loading-spinner" id="loginSpinner">
                <i class="fas fa-spinner fa-spin"></i> Logging in...
              </div>
            </form>
            <div class="text-center mt-3" id="registerLink">
              <a href="#" onclick="showRegisterForm()">New customer? Register here</a>
            </div>
          </div>
          
          <!-- Register Form -->
          <div id="registerFormDiv" class="hidden">
            <form id="registerForm">
              <div class="form-group">
                <label><i class="fas fa-user"></i> Full Name *</label>
                <input type="text" class="form-control" id="registerName" required minlength="3">
                <div class="error-message" id="registerNameError"></div>
              </div>
              <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email *</label>
                <input type="email" class="form-control" id="registerEmail" required>
                <div class="error-message" id="registerEmailError"></div>
              </div>
              <div class="form-group">
                <label><i class="fas fa-phone"></i> Phone *</label>
                <input type="tel" class="form-control" id="registerPhone" required pattern="[0-9]{10}" maxlength="10">
                <small class="form-text text-muted">10-digit mobile number</small>
                <div class="error-message" id="registerPhoneError"></div>
              </div>
              <div class="form-group">
                <label><i class="fas fa-lock"></i> Password *</label>
                <input type="password" class="form-control" id="registerPassword" required minlength="6">
                <div class="password-strength" id="passwordStrength"></div>
                <small class="form-text text-muted">Minimum 6 characters</small>
                <div class="error-message" id="registerPasswordError"></div>
              </div>
              <div class="form-group">
                <label><i class="fas fa-lock"></i> Confirm Password *</label>
                <input type="password" class="form-control" id="registerConfirmPassword" required>
                <div class="error-message" id="registerConfirmPasswordError"></div>
              </div>
              <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> Address *</label>
                <textarea class="form-control" id="registerAddress" rows="2" required minlength="10"></textarea>
                <div class="error-message" id="registerAddressError"></div>
              </div>
              <button type="submit" class="custom-button btn-block">Register</button>
            </form>
            <div class="text-center mt-3">
              <a href="#" onclick="showLoginForm()">Already have an account? Login</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Modal -->
  <div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Your Cart</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="cartItems"></div>
          <h4 class="text-right mt-3">Total: ₹<span id="cartTotal">0</span></h4>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="clearCart()">Clear Cart</button>
          <button class="custom-button" onclick="proceedToOrder()">Proceed to Order</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Form Modal -->
  <div class="modal fade" id="orderModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Complete Your Order</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="orderForm">
            <div class="form-group">
              <label>Full Name *</label>
              <input type="text" class="form-control" id="orderName" required>
            </div>
            <div class="form-group">
              <label>Phone Number *</label>
              <input type="tel" class="form-control" id="orderPhone" required pattern="[0-9]{10}">
            </div>
            <div class="form-group">
              <label>Delivery Address *</label>
              <textarea class="form-control" id="orderAddress" rows="3" required></textarea>
            </div>
            <button type="submit" class="custom-button btn-block">Place Order</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- My Orders Modal -->
  <div class="modal fade" id="myOrdersModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">My Order History</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="myOrdersContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delivery Boy Register Modal -->
  <div class="modal fade" id="deliveryRegisterModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delivery Boy Registration</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="deliveryRegisterForm">
            <div class="form-group">
              <label><i class="fas fa-user"></i> Full Name *</label>
              <input type="text" class="form-control" id="deliveryRegName" required minlength="3">
              <div class="error-message" id="deliveryRegNameError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-envelope"></i> Email *</label>
              <input type="email" class="form-control" id="deliveryRegEmail" required>
              <div class="error-message" id="deliveryRegEmailError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-phone"></i> Phone *</label>
              <input type="tel" class="form-control" id="deliveryRegPhone" required pattern="[0-9]{10}" maxlength="10">
              <small class="form-text text-muted">10-digit mobile number</small>
              <div class="error-message" id="deliveryRegPhoneError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-id-card"></i> Vehicle Number *</label>
              <input type="text" class="form-control" id="deliveryVehicleNumber" required minlength="6">
              <small class="form-text text-muted">e.g., AP39AB1234</small>
              <div class="error-message" id="deliveryVehicleNumberError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Password *</label>
              <input type="password" class="form-control" id="deliveryRegPassword" required minlength="6">
              <div class="password-strength" id="deliveryPasswordStrength"></div>
              <small class="form-text text-muted">Minimum 6 characters</small>
              <div class="error-message" id="deliveryRegPasswordError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Confirm Password *</label>
              <input type="password" class="form-control" id="deliveryRegConfirmPassword" required>
              <div class="error-message" id="deliveryRegConfirmPasswordError"></div>
            </div>
            <button type="submit" class="custom-button btn-block">Register as Delivery Boy</button>
          </form>
          <div class="text-center mt-3">
            <a href="#" onclick="$('#deliveryRegisterModal').modal('hide'); showLoginModal('delivery');">Already registered? Login here</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Register Modal -->
  <div class="modal fade" id="adminRegisterModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Admin Registration</h5>
          <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="adminRegisterForm">
            <div class="form-group">
              <label><i class="fas fa-user-shield"></i> Admin Name *</label>
              <input type="text" class="form-control" id="adminRegName" required minlength="3">
              <div class="error-message" id="adminRegNameError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-envelope"></i> Email *</label>
              <input type="email" class="form-control" id="adminRegEmail" required>
              <div class="error-message" id="adminRegEmailError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-phone"></i> Phone *</label>
              <input type="tel" class="form-control" id="adminRegPhone" required pattern="[0-9]{10}" maxlength="10">
              <small class="form-text text-muted">10-digit mobile number</small>
              <div class="error-message" id="adminRegPhoneError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-key"></i> Admin Code *</label>
              <input type="text" class="form-control" id="adminCode" required minlength="6">
              <small class="form-text text-muted">Secret admin registration code: <strong>FOODMUNCH2024</strong></small>
              <div class="error-message" id="adminCodeError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Password *</label>
              <input type="password" class="form-control" id="adminRegPassword" required minlength="8">
              <div class="password-strength" id="adminPasswordStrength"></div>
              <small class="form-text text-muted">Minimum 8 characters</small>
              <div class="error-message" id="adminRegPasswordError"></div>
            </div>
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Confirm Password *</label>
              <input type="password" class="form-control" id="adminRegConfirmPassword" required>
              <div class="error-message" id="adminRegConfirmPasswordError"></div>
            </div>
            <button type="submit" class="custom-button btn-block">Register as Admin</button>
          </form>
          <div class="text-center mt-3">
            <a href="#" onclick="$('#adminRegisterModal').modal('hide'); showLoginModal('admin');">Already registered? Login here</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api';
    let cart = [];
    let selectedRating = 0;
    let currentCustomer = null;
    let currentLoginType = 'customer';
    let authToken = null;

    // Menu Data
    const menuCategories = [
      {
        id: 1,
        name: "Non-Veg Starters",
        image: "https://images.unsplash.com/photo-1599487488170-d11ec9c172f0?w=400",
        description: "Delicious non-vegetarian appetizers"
      },
      {
        id: 2,
        name: "Veg Starters",
        image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?w=400",
        description: "Fresh vegetarian starters"
      },
      {
        id: 3,
        name: "Soups",
        image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?w=400",
        description: "Hot and comforting soups"
      },
      {
        id: 4,
        name: "Main Course",
        image: "https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=400",
        description: "Hearty main dishes"
      },
      {
        id: 5,
        name: "Seafood",
        image: "https://images.unsplash.com/photo-1559737558-2f5a99f2f84f?w=400",
        description: "Fresh from the ocean"
      },
      {
        id: 6,
        name: "Noodles & Rice",
        image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?w=400",
        description: "Asian delicacies"
      },
      {
        id: 7,
        name: "Salads",
        image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400",
        description: "Healthy and fresh"
      },
      {
        id: 8,
        name: "Desserts",
        image: "https://images.unsplash.com/photo-1551024601-bec78aea704b?w=400",
        description: "Sweet endings"
      }
    ];

    const menuItems = {
      1: [
        { id: 101, name: "Chicken 65", price: 220, image: "https://images.unsplash.com/photo-1599487488170-d11ec9c172f0?w=300" },
        { id: 102, name: "Chicken Tikka", price: 250, image: "https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?w=300" },
        { id: 103, name: "Fish Fry", price: 280, image: "https://images.unsplash.com/photo-1580959378302-95329821c1e8?w=300" },
        { id: 104, name: "Mutton Seekh Kebab", price: 320, image: "https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?w=300" },
        { id: 105, name: "Tandoori Chicken", price: 300, image: "https://images.unsplash.com/photo-1610057099443-fde8c4d50f91?w=300" },
        { id: 106, name: "Chicken Wings", price: 240, image: "https://images.unsplash.com/photo-1527477396000-e27163b481c2?w=300" }
      ],
      2: [
        { id: 201, name: "Paneer Tikka", price: 180, image: "https://images.unsplash.com/photo-1631452180519-c014fe946bc7?w=300" },
        { id: 202, name: "Veg Spring Rolls", price: 150, image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?w=300" },
        { id: 203, name: "Mushroom Pepper Dry", price: 190, image: "https://images.unsplash.com/photo-1608877907149-a206d75ba011?w=300" },
        { id: 204, name: "Gobi Manchurian", price: 160, image: "https://images.unsplash.com/photo-1606491956689-2ea866880c84?w=300" },
        { id: 205, name: "Hara Bhara Kabab", price: 170, image: "https://images.unsplash.com/photo-1626645738196-c2a7c87a8f58?w=300" },
        { id: 206, name: "Crispy Corn", price: 140, image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?w=300" }
      ],
      3: [
        { id: 301, name: "Tomato Soup", price: 100, image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?w=300" },
        { id: 302, name: "Hot & Sour Soup", price: 120, image: "https://images.unsplash.com/photo-1588566565463-180a5b2090d2?w=300" },
        { id: 303, name: "Manchow Soup", price: 130, image: "https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=300" },
        { id: 304, name: "Chicken Clear Soup", price: 140, image: "https://images.unsplash.com/photo-1587039800969-128b88e07af5?w=300" },
        { id: 305, name: "Sweet Corn Soup", price: 110, image: "https://images.unsplash.com/photo-1547592180-85f173990554?w=300" },
        { id: 306, name: "Lemon Coriander Soup", price: 120, image: "https://images.unsplash.com/photo-1547592180-85f173990554?w=300" }
      ],
      4: [
        { id: 401, name: "Chicken Biryani", price: 280, image: "https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=300" },
        { id: 402, name: "Mutton Biryani", price: 350, image: "https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=300" },
        { id: 403, name: "Butter Chicken", price: 320, image: "https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?w=300" },
        { id: 404, name: "Paneer Butter Masala", price: 250, image: "https://images.unsplash.com/photo-1631452180519-c014fe946bc7?w=300" },
        { id: 405, name: "Dal Makhani", price: 200, image: "https://images.unsplash.com/photo-1546833998-877b37c2e5c6?w=300" },
        { id: 406, name: "Veg Biryani", price: 220, image: "https://images.unsplash.com/photo-1563379091339-03b21ab4a4f8?w=300" }
      ],
      5: [
        { id: 501, name: "Grilled Fish", price: 400, image: "https://images.unsplash.com/photo-1559737558-2f5a99f2f84f?w=300" },
        { id: 502, name: "Prawn Curry", price: 450, image: "https://images.unsplash.com/photo-1565680018434-b513d5e5fd47?w=300" },
        { id: 503, name: "Fish Tikka", price: 380, image: "https://images.unsplash.com/photo-1580959378302-95329821c1e8?w=300" },
        { id: 504, name: "Crab Masala", price: 500, image: "https://images.unsplash.com/photo-1535473895227-bdecb20fb157?w=300" },
        { id: 505, name: "Prawn Fry", price: 420, image: "https://images.unsplash.com/photo-1565680018434-b513d5e5fd47?w=300" },
        { id: 506, name: "Fish Curry", price: 380, image: "https://images.unsplash.com/photo-1580959378302-95329821c1e8?w=300" }
      ],
      6: [
        { id: 601, name: "Veg Hakka Noodles", price: 180, image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?w=300" },
        { id: 602, name: "Chicken Noodles", price: 220, image: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=300" },
        { id: 603, name: "Schezwan Fried Rice", price: 200, image: "https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=300" },
        { id: 604, name: "Singapore Noodles", price: 240, image: "https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=300" },
        { id: 605, name: "Thai Fried Rice", price: 250, image: "https://images.unsplash.com/photo-1516684732162-798a0062be99?w=300" },
        { id: 606, name: "Egg Fried Rice", price: 190, image: "https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=300" }
      ],
      7: [
        { id: 701, name: "Greek Salad", price: 150, image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=300" },
        { id: 702, name: "Caesar Salad", price: 180, image: "https://images.unsplash.com/photo-1546793665-c74683f339c1?w=300" },
        { id: 703, name: "Garden Fresh Salad", price: 130, image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300" },
        { id: 704, name: "Chicken Salad", price: 200, image: "https://images.unsplash.com/photo-1604909052743-94e838986d24?w=300" },
        { id: 705, name: "Fruit Salad", price: 140, image: "https://images.unsplash.com/photo-1564093497595-593b96d80180?w=300" },
        { id: 706, name: "Chickpea Salad", price: 160, image: "https://images.unsplash.com/photo-1505576391880-b3f9d713dc4f?w=300" }
      ],
      8: [
        { id: 801, name: "Gulab Jamun", price: 120, image: "https://images.unsplash.com/photo-1589301760014-b9837a42f35b?w=300" },
        { id: 802, name: "Ice Cream Sundae", price: 150, image: "https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=300" },
        { id: 803, name: "Chocolate Brownie", price: 180, image: "https://images.unsplash.com/photo-1607920591413-4ec007e70023?w=300" },
        { id: 804, name: "Rasmalai", price: 140, image: "https://images.unsplash.com/photo-1626776876729-bab4fe8c5f0e?w=300" },
        { id: 805, name: "Tiramisu", price: 200, image: "https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=300" },
        { id: 806, name: "Kheer (Rice Pudding)", price: 130, image: "https://images.unsplash.com/photo-1516684732162-798a0062be99?w=300" }
      ]
    };

    // Validation functions
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function validatePhone(phone) {
      const re = /^[0-9]{10}$/;
      return re.test(phone);
    }

    function checkPasswordStrength(password) {
      if (password.length < 6) return 'weak';
      if (password.length < 10) return 'medium';
      return 'strong';
    }

    // Initialize
    window.onload = function() {
      checkLoginStatus();
      displayCategories();
      setupRatingStars();
      updateCartCount();
      setupValidation();
      setupDeliveryRegisterValidation();
      setupAdminRegisterValidation();
    };

    // Setup real-time validation
    function setupValidation() {
      const registerPassword = document.getElementById('registerPassword');
      if (registerPassword) {
        registerPassword.addEventListener('input', function() {
          const strength = checkPasswordStrength(this.value);
          const strengthBar = document.getElementById('passwordStrength');
          strengthBar.className = 'password-strength';
          if (this.value.length > 0) {
            strengthBar.classList.add('strength-' + strength);
          }
        });
      }

      const phoneInputs = document.querySelectorAll('input[type="tel"]');
      phoneInputs.forEach(input => {
        input.addEventListener('input', function() {
          this.value = this.value.replace(/[^0-9]/g, '');
        });
      });
    }

    function setupDeliveryRegisterValidation() {
      const deliveryPassword = document.getElementById('deliveryRegPassword');
      if (deliveryPassword) {
        deliveryPassword.addEventListener('input', function() {
          const strength = checkPasswordStrength(this.value);
          const strengthBar = document.getElementById('deliveryPasswordStrength');
          strengthBar.className = 'password-strength';
          if (this.value.length > 0) {
            strengthBar.classList.add('strength-' + strength);
          }
        });
      }
    }

    function setupAdminRegisterValidation() {
      const adminPassword = document.getElementById('adminRegPassword');
      if (adminPassword) {
        adminPassword.addEventListener('input', function() {
          const strength = checkPasswordStrength(this.value);
          const strengthBar = document.getElementById('adminPasswordStrength');
          strengthBar.className = 'password-strength';
          if (this.value.length > 0) {
            strengthBar.classList.add('strength-' + strength);
          }
        });
      }
    }

    // Check Login Status
    function checkLoginStatus() {
      const storedCustomer = localStorage.getItem('currentCustomer');
      const storedToken = localStorage.getItem('authToken');
      if (storedCustomer && storedToken) {
        currentCustomer = JSON.parse(storedCustomer);
        authToken = storedToken;
        updateUIForLoggedInUser();
      }
    }

    function updateUIForLoggedInUser() {
      document.getElementById('guestView').style.display = 'none';
      document.getElementById('loggedInView').style.display = 'block';
      document.getElementById('userInfoView').style.display = 'block';
      document.getElementById('userName').textContent = currentCustomer.name;
      document.getElementById('feedbackName').value = currentCustomer.name;
      document.getElementById('feedbackEmail').value = currentCustomer.email;
    }

    function logout() {
      localStorage.removeItem('currentCustomer');
      localStorage.removeItem('authToken');
      currentCustomer = null;
      authToken = null;
      document.getElementById('guestView').style.display = 'block';
      document.getElementById('loggedInView').style.display = 'none';
      document.getElementById('userInfoView').style.display = 'none';
      cart = [];
      updateCartCount();
      alert('✅ Logged out successfully!');
      location.reload();
    }

    // Login Modal
    function showLoginModal(type) {
      currentLoginType = type;
      $('#loginModal').modal('show');
      showLoginForm();
      
      if (type === 'customer') {
        document.getElementById('loginModalTitle').textContent = 'Customer Login';
        document.getElementById('registerLink').style.display = 'block';
        document.getElementById('registerLink').innerHTML = '<a href="#" onclick="showRegisterForm()">New customer? Register here</a>';
      } else if (type === 'delivery') {
        document.getElementById('loginModalTitle').textContent = 'Delivery Boy Login';
        document.getElementById('registerLink').style.display = 'block';
        document.getElementById('registerLink').innerHTML = '<a href="#" onclick="showDeliveryRegisterModal()">New delivery boy? Register here</a>';
      } else if (type === 'admin') {
        document.getElementById('loginModalTitle').textContent = 'Admin Login';
        document.getElementById('registerLink').style.display = 'block';
        document.getElementById('registerLink').innerHTML = '<a href="#" onclick="showAdminRegisterModal()">New admin? Register here</a>';
      }
    }

    function showLoginForm() {
      document.getElementById('loginFormDiv').classList.remove('hidden');
      document.getElementById('registerFormDiv').classList.add('hidden');
      clearFormErrors();
    }

    function showRegisterForm() {
      document.getElementById('loginFormDiv').classList.add('hidden');
      document.getElementById('registerFormDiv').classList.remove('hidden');
      document.getElementById('loginModalTitle').textContent = 'Customer Registration';
      clearFormErrors();
    }

    function showDeliveryRegisterModal() {
      $('#loginModal').modal('hide');
      $('#deliveryRegisterModal').modal('show');
    }

    function showAdminRegisterModal() {
      $('#loginModal').modal('hide');
      $('#adminRegisterModal').modal('show');
    }

    function clearFormErrors() {
      document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
      document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
    }

    function showError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorDiv = document.getElementById(fieldId + 'Error');
      if (field) field.classList.add('input-error');
      if (errorDiv) errorDiv.textContent = message;
    }

    // Login Handler - FIXED WITH JWT
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearFormErrors();
      
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;

      if (!validateEmail(email)) {
        showError('loginEmail', 'Please enter a valid email address');
        return;
      }

      if (password.length < 6) {
        showError('loginPassword', 'Password must be at least 6 characters');
        return;
      }

      const spinner = document.getElementById('loginSpinner');
      spinner.classList.add('active');

      try {
        let endpoint = '';
        
        if (currentLoginType === 'customer') {
          endpoint = `${API_URL}/customer/login`;
        } else if (currentLoginType === 'delivery') {
          endpoint = `${API_URL}/deliveryboy/login`;
        } else if (currentLoginType === 'admin') {
          endpoint = `${API_URL}/admin/login`;
        }

        const response = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();
        spinner.classList.remove('active');
        
        if (data.success) {
          // Store JWT token
          localStorage.setItem('authToken', data.token);
          
          // Close modal first
          $('#loginModal').modal('hide');
          document.getElementById('loginForm').reset();
          
          if (currentLoginType === 'customer') {
            currentCustomer = data.customer;
            authToken = data.token;
            localStorage.setItem('currentCustomer', JSON.stringify(currentCustomer));
            updateUIForLoggedInUser();
            alert('✅ Login successful! Welcome ' + currentCustomer.name);
          } else if (currentLoginType === 'delivery') {
            localStorage.setItem('currentDeliveryBoy', JSON.stringify(data.delivery_boy));
            alert('✅ Login successful! Redirecting to Delivery Portal...');
            setTimeout(() => {
              window.location.href = 'deliveryboy_portal.html';
            }, 500);
          } else if (currentLoginType === 'admin') {
            localStorage.setItem('currentAdmin', JSON.stringify(data.admin));
            alert('✅ Login successful! Redirecting to Admin Panel...');
            setTimeout(() => {
              window.location.href = 'admin.html';
            }, 500);
          }
        } else {
          showError('loginPassword', data.message || 'Invalid credentials');
        }
      } catch (error) {
        spinner.classList.remove('active');
        console.error('Error:', error);
        alert('❌ Login failed. Please check:\n1. Backend server is running on http://localhost:5000\n2. Network connection is working\n3. CORS is properly configured');
      }
    });

    // Customer Register Handler
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearFormErrors();
      
      const name = document.getElementById('registerName').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const phone = document.getElementById('registerPhone').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;
      const address = document.getElementById('registerAddress').value.trim();

      let isValid = true;

      if (name.length < 3) {
        showError('registerName', 'Name must be at least 3 characters');
        isValid = false;
      }

      if (!validateEmail(email)) {
        showError('registerEmail', 'Please enter a valid email address');
        isValid = false;
      }

      if (!validatePhone(phone)) {
        showError('registerPhone', 'Please enter a valid 10-digit phone number');
        isValid = false;
      }

      if (password.length < 6) {
        showError('registerPassword', 'Password must be at least 6 characters');
        isValid = false;
      }

      if (password !== confirmPassword) {
        showError('registerConfirmPassword', 'Passwords do not match');
        isValid = false;
      }

      if (address.length < 10) {
        showError('registerAddress', 'Please enter a complete address (minimum 10 characters)');
        isValid = false;
      }

      if (!isValid) return;

      try {
        const response = await fetch(`${API_URL}/customer/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, phone, password, address })
        });

        const data = await response.json();
        if (data.success) {
          alert('✅ Registration successful! Please login now.');
          showLoginForm();
          document.getElementById('registerForm').reset();
          document.getElementById('passwordStrength').className = 'password-strength';
        } else {
          if (data.message.includes('email')) {
            showError('registerEmail', data.message);
          } else {
            alert('❌ ' + data.message);
          }
        }
      } catch (error) {
        console.error('Error:', error);
        alert('❌ Registration failed. Make sure backend is running!');
      }
    });

    // Delivery Boy Register Handler
    document.getElementById('deliveryRegisterForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('deliveryRegName').value.trim();
      const email = document.getElementById('deliveryRegEmail').value.trim();
      const phone = document.getElementById('deliveryRegPhone').value.trim();
      const vehicleNumber = document.getElementById('deliveryVehicleNumber').value.trim();
      const password = document.getElementById('deliveryRegPassword').value;
      const confirmPassword = document.getElementById('deliveryRegConfirmPassword').value;

      let isValid = true;

      if (name.length < 3) {
        showError('deliveryRegName', 'Name must be at least 3 characters');
        isValid = false;
      }

      if (!validateEmail(email)) {
        showError('deliveryRegEmail', 'Please enter a valid email address');
        isValid = false;
      }

      if (!validatePhone(phone)) {
        showError('deliveryRegPhone', 'Please enter a valid 10-digit phone number');
        isValid = false;
      }

      if (vehicleNumber.length < 6) {
        showError('deliveryVehicleNumber', 'Please enter a valid vehicle number');
        isValid = false;
      }

      if (password.length < 6) {
        showError('deliveryRegPassword', 'Password must be at least 6 characters');
        isValid = false;
      }

      if (password !== confirmPassword) {
        showError('deliveryRegConfirmPassword', 'Passwords do not match');
        isValid = false;
      }

      if (!isValid) return;

      try {
        const response = await fetch(`${API_URL}/deliveryboy/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, phone, vehicle_number: vehicleNumber, password })
        });

        const data = await response.json();
        if (data.success) {
          alert('✅ Delivery Boy Registration successful! Please login now.');
          $('#deliveryRegisterModal').modal('hide');
          document.getElementById('deliveryRegisterForm').reset();
          document.getElementById('deliveryPasswordStrength').className = 'password-strength';
          showLoginModal('delivery');
        } else {
          if (data.message.includes('email')) {
            showError('deliveryRegEmail', data.message);
          } else if (data.message.includes('phone')) {
            showError('deliveryRegPhone', data.message);
          } else {
            alert('❌ ' + data.message);
          }
        }
      } catch (error) {
        console.error('Error:', error);
        alert('❌ Registration failed. Make sure backend is running!');
      }
    });

    // Admin Register Handler
    document.getElementById('adminRegisterForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('adminRegName').value.trim();
      const email = document.getElementById('adminRegEmail').value.trim();
      const phone = document.getElementById('adminRegPhone').value.trim();
      const adminCode = document.getElementById('adminCode').value.trim();
      const password = document.getElementById('adminRegPassword').value;
      const confirmPassword = document.getElementById('adminRegConfirmPassword').value;

      let isValid = true;

      if (name.length < 3) {
        showError('adminRegName', 'Name must be at least 3 characters');
        isValid = false;
      }

      if (!validateEmail(email)) {
        showError('adminRegEmail', 'Please enter a valid email address');
        isValid = false;
      }

      if (!validatePhone(phone)) {
        showError('adminRegPhone', 'Please enter a valid 10-digit phone number');
        isValid = false;
      }

      if (adminCode !== 'FOODMUNCH2024') {
        showError('adminCode', 'Invalid admin registration code');
        isValid = false;
      }

      if (password.length < 8) {
        showError('adminRegPassword', 'Admin password must be at least 8 characters');
        isValid = false;
      }

      if (password !== confirmPassword) {
        showError('adminRegConfirmPassword', 'Passwords do not match');
        isValid = false;
      }

      if (!isValid) return;

      try {
        const response = await fetch(`${API_URL}/admin/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, phone, admin_code: adminCode, password })
        });

        const data = await response.json();
        if (data.success) {
          alert('✅ Admin Registration successful! Please login now.');
          $('#adminRegisterModal').modal('hide');
          document.getElementById('adminRegisterForm').reset();
          document.getElementById('adminPasswordStrength').className = 'password-strength';
          showLoginModal('admin');
        } else {
          if (data.message.includes('email')) {
            showError('adminRegEmail', data.message);
          } else if (data.message.includes('code')) {
            showError('adminCode', data.message);
          } else {
            alert('❌ ' + data.message);
          }
        }
      } catch (error) {
        console.error('Error:', error);
        alert('❌ Registration failed. Make sure backend is running!');
      }
    });

    // Display Categories
    function displayCategories() {
      const container = document.getElementById('menuCategories');
      container.innerHTML = menuCategories.map(category => `
        <div class="col-md-3 col-sm-6 mb-4">
          <div class="category-card" onclick="showCategoryItems(${category.id}, '${category.name}')">
            <img src="${category.image}" class="category-image" alt="${category.name}" onerror="this.src='https://via.placeholder.com/400x200?text=${encodeURIComponent(category.name)}'">
            <div class="p-3">
              <h5 class="mb-2">${category.name}</h5>
              <p class="text-muted mb-0">${category.description}</p>
            </div>
          </div>
        </div>
      `).join('');
    }

    function showCategories() {
      document.getElementById('categoriesView').classList.remove('hidden');
      document.getElementById('itemsView').classList.add('hidden');
    }

    function showCategoryItems(categoryId, categoryName) {
      document.getElementById('categoriesView').classList.add('hidden');
      document.getElementById('itemsView').classList.remove('hidden');
      document.getElementById('categoryTitle').textContent = categoryName;
      
      const items = menuItems[categoryId] || [];
      const container = document.getElementById('menuItems');
      
      container.innerHTML = items.map(item => `
        <div class="col-md-4 col-sm-6 mb-4">
          <div class="menu-item-card">
            <img src="${item.image}" class="menu-item-image" alt="${item.name}" onerror="this.src='https://via.placeholder.com/300x180?text=${encodeURIComponent(item.name)}'">
            <div class="p-3">
              <h5>${item.name}</h5>
              <div class="price-tag">₹${item.price}</div>
              <button class="add-to-cart-btn" onclick='addToCart(${JSON.stringify(item)})'>
                <i class="fas fa-cart-plus"></i> Add to Cart
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Cart Functions
    function addToCart(item) {
      const existingItem = cart.find(i => i.id === item.id);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({ ...item, quantity: 1 });
      }
      updateCartCount();
      alert(`✅ ${item.name} added to cart!`);
    }

    function updateCartCount() {
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = count;
    }

    function openCart() {
      displayCart();
      $('#cartModal').modal('show');
    }

    function displayCart() {
      const container = document.getElementById('cartItems');
      
      if (cart.length === 0) {
        container.innerHTML = `
          <div class="empty-cart">
            <i class="fas fa-shopping-cart"></i>
            <p>Your cart is empty</p>
          </div>
        `;
        document.getElementById('cartTotal').textContent = '0';
        return;
      }

      container.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div>
            <h6>${item.name}</h6>
            <p class="mb-0 text-muted">₹${item.price} each</p>
          </div>
          <div class="d-flex align-items-center">
            <div class="quantity-controls mr-3">
              <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
              <span class="mx-2">${item.quantity}</span>
              <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
            </div>
            <strong class="mr-3">₹${item.price * item.quantity}</strong>
            <button class="remove-btn" onclick="removeFromCart(${item.id})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `).join('');

      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      document.getElementById('cartTotal').textContent = total;
    }

    function updateQuantity(itemId, change) {
      const item = cart.find(i => i.id === itemId);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(itemId);
        } else {
          displayCart();
          updateCartCount();
        }
      }
    }

    function removeFromCart(itemId) {
      cart = cart.filter(item => item.id !== itemId);
      displayCart();
      updateCartCount();
    }

    function clearCart() {
      if (confirm('Are you sure you want to clear the cart?')) {
        cart = [];
        displayCart();
        updateCartCount();
      }
    }

    // Order Functions
    function proceedToOrder() {
      if (cart.length === 0) {
        alert('❌ Your cart is empty! Please add items first.');
        return;
      }

      if (!currentCustomer || !authToken) {
        alert('❌ Please login to place an order!');
        $('#cartModal').modal('hide');
        showLoginModal('customer');
        return;
      }

      $('#cartModal').modal('hide');
      $('#orderModal').modal('show');
      
      document.getElementById('orderName').value = currentCustomer.name;
      document.getElementById('orderPhone').value = currentCustomer.phone;
      document.getElementById('orderAddress').value = currentCustomer.address || '';
    }

    document.getElementById('orderForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const orderData = {
        customer_id: currentCustomer.id,
        customer_name: document.getElementById('orderName').value,
        phone: document.getElementById('orderPhone').value,
        address: document.getElementById('orderAddress').value,
        items: cart,
        total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
      };

      try {
        const response = await fetch(`${API_URL}/order`, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(orderData)
        });

        const data = await response.json();
        if (data.success) {
          alert('🎉 Order placed successfully! Order ID: ' + data.order_id);
          cart = [];
          updateCartCount();
          $('#orderModal').modal('hide');
          document.getElementById('orderForm').reset();
        } else {
          alert('❌ ' + data.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('❌ Failed to place order. Please try again!');
      }
    });

    // My Orders
    async function showMyOrders() {
      if (!currentCustomer || !authToken) {
        alert('❌ Please login to view your orders!');
        showLoginModal('customer');
        return;
      }

      try {
        const response = await fetch(`${API_URL}/customer/${currentCustomer.id}/orders`, {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });
        const data = await response.json();
        
        if (data.success) {
          displayMyOrders(data.orders);
          $('#myOrdersModal').modal('show');
        } else {
          alert('❌ ' + data.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('❌ Failed to load orders!');
      }
    }

    function displayMyOrders(orders) {
      const container = document.getElementById('myOrdersContainer');
      
      if (orders.length === 0) {
        container.innerHTML = `
          <div class="empty-cart">
            <i class="fas fa-receipt"></i>
            <p>No orders yet</p>
            <small class="text-muted">Start ordering to see your history here!</small>
          </div>
        `;
        return;
      }

      container.innerHTML = orders.map(order => {
        let statusClass = '';
        if (order.delivery_status === 'pending_assignment') statusClass = 'status-pending';
        else if (order.delivery_status === 'assigned') statusClass = 'status-assigned';
        else if (order.delivery_status === 'out_for_delivery') statusClass = 'status-delivering';
        else if (order.delivery_status === 'delivered') statusClass = 'status-delivered';

        let deliveryInfo = '';
        if (order.delivery_boy_name) {
          deliveryInfo = `
            <div class="delivery-boy-info">
              <strong><i class="fas fa-motorcycle"></i> Delivery Boy:</strong> ${order.delivery_boy_name}<br>
              <strong><i class="fas fa-phone"></i> Contact:</strong> <a href="tel:${order.delivery_boy_phone}">${order.delivery_boy_phone}</a>
            </div>
          `;
        }

        let timeline = '<div class="delivery-timeline"><strong>Order Timeline:</strong>';
        if (order.created_at) timeline += `<div>📦 Order Placed: ${formatDateTime(order.created_at)}</div>`;
        if (order.pickup_time) timeline += `<div>🚚 Picked Up: ${formatDateTime(order.pickup_time)}</div>`;
        if (order.delivered_time) timeline += `<div>✅ Delivered: ${formatDateTime(order.delivered_time)}</div>`;
        timeline += '</div>';

        return `
          <div class="order-history-item ${order.delivery_status === 'delivered' ? 'delivered' : ''}">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <div>
                <h5><i class="fas fa-receipt"></i> Order #${order.id}</h5>
                <p class="mb-1 text-muted">${formatDateTime(order.created_at)}</p>
              </div>
              <span class="status-badge ${statusClass}">
                ${order.status}
              </span>
            </div>
            
            <div class="mb-3">
              <strong>Items Ordered:</strong>
              <ul class="mt-2">
                ${order.items.map(item => `
                  <li>${item.name} x ${item.quantity} = ₹${item.price * item.quantity}</li>
                `).join('')}
              </ul>
              <h5 class="text-success">Total: ₹${order.total}</h5>
            </div>

            <div class="mb-2">
              <strong><i class="fas fa-map-marker-alt"></i> Delivery Address:</strong> ${order.address}
            </div>

            ${deliveryInfo}
            ${timeline}
          </div>
        `;
      }).join('');
    }

    function formatDateTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('en-IN', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Rating Stars
    function setupRatingStars() {
      const stars = document.querySelectorAll('#ratingStars i');
      stars.forEach(star => {
        star.addEventListener('click', function() {
          selectedRating = parseInt(this.dataset.rating);
          document.getElementById('feedbackRating').value = selectedRating;
          document.getElementById('ratingDisplay').textContent = selectedRating;
          
          stars.forEach((s, index) => {
            if (index < selectedRating) {
              s.classList.remove('far');
              s.classList.add('fas');
            } else {
              s.classList.remove('fas');
              s.classList.add('far');
            }
          });
        });
      });
    }

    // Feedback Form
    document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!selectedRating) {
        alert('❌ Please select a rating!');
        return;
      }

      const feedbackData = {
        customer_id: currentCustomer ? currentCustomer.id : null,
        name: document.getElementById('feedbackName').value,
        email: document.getElementById('feedbackEmail').value,
        rating: selectedRating,
        comment: document.getElementById('feedbackComment').value
      };

      try {
        const response = await fetch(`${API_URL}/feedback`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(feedbackData)
        });

        const data = await response.json();
        if (data.success) {
          alert('🎉 Thank you for your feedback!');
          document.getElementById('feedbackForm').reset();
          selectedRating = 0;
          document.getElementById('ratingDisplay').textContent = '0';
          document.querySelectorAll('#ratingStars i').forEach(s => {
            s.classList.remove('fas');
            s.classList.add('far');
          });
        } else {
          alert('❌ ' + data.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('❌ Failed to submit feedback!');
      }
    });
  </script>
</body>
</html>