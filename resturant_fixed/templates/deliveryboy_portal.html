<!DOCTYPE html>
<html>
<head>
  <title>Delivery Boy Portal - Food Munch</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/d1c2ea8b80.js" crossorigin="anonymous"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap");
    
    * { font-family: 'Roboto', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #f5f7fa; }
    
    .delivery-navbar {
      background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
      color: white;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .delivery-navbar h2 {
      margin: 0;
      font-weight: 300;
    }
    
    .delivery-info {
      display: flex;
      align-items: center;
      color: white;
    }
    
    .delivery-info i {
      font-size: 32px;
      margin-right: 15px;
    }
    
    .logout-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid white;
      padding: 8px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      margin-left: 20px;
    }
    
    .logout-btn:hover {
      background: white;
      color: #6f42c1;
    }
    
    .status-toggle {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .status-badge {
      display: inline-block;
      padding: 10px 30px;
      border-radius: 25px;
      font-size: 18px;
      font-weight: bold;
      margin: 10px;
    }
    
    .status-available {
      background: #28a745;
      color: white;
    }
    
    .status-busy {
      background: #ffc107;
      color: #000;
    }
    
    .toggle-status-btn {
      background: #6f42c1;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      margin-top: 10px;
    }
    
    .toggle-status-btn:hover {
      background: #5a32a3;
      transform: translateY(-2px);
    }
    
    .stats-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      flex: 1;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .stat-card h3 {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #6f42c1;
    }
    
    .stat-card p {
      color: #666;
      margin: 0;
    }
    
    .orders-section {
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .order-card {
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s;
      position: relative;
    }
    
    .order-card:hover {
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      border-color: #6f42c1;
    }
    
    .order-card.new-order {
      border-color: #17a2b8;
      background: #e7f3ff;
    }
    
    .order-card.delivering {
      border-color: #fd7e14;
      background: #fff3e0;
    }
    
    .order-card.completed {
      border-color: #28a745;
      background: #e8f5e9;
      opacity: 0.7;
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .order-id {
      font-size: 20px;
      font-weight: bold;
      color: #6f42c1;
    }
    
    .order-status {
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: bold;
    }
    
    .status-assigned { background: #17a2b8; color: #fff; }
    .status-delivering { background: #fd7e14; color: #fff; }
    .status-delivered { background: #28a745; color: #fff; }
    
    .customer-info {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .customer-info p {
      margin-bottom: 8px;
    }
    
    .order-items {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    
    .action-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      font-size: 14px;
    }
    
    .btn-pickup {
      background: #17a2b8;
      color: white;
    }
    
    .btn-pickup:hover {
      background: #138496;
    }
    
    .btn-deliver {
      background: #28a745;
      color: white;
    }
    
    .btn-deliver:hover {
      background: #218838;
    }
    
    .btn-call {
      background: #fd7e14;
      color: white;
    }
    
    .btn-call:hover {
      background: #e96b0b;
    }
    
    .btn-navigate {
      background: #6f42c1;
      color: white;
    }
    
    .btn-navigate:hover {
      background: #5a32a3;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .tab {
      padding: 12px 25px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    
    .tab:hover {
      color: #6f42c1;
    }
    
    .tab.active {
      color: #6f42c1;
      border-bottom-color: #6f42c1;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .empty-state i {
      font-size: 64px;
      color: #ddd;
      margin-bottom: 20px;
    }
    
    .earnings-summary {
      background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
      color: white;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(111, 66, 193, 0.3);
    }
    
    .earnings-summary h3 {
      font-size: 42px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .delivery-history-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #28a745;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .refresh-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      float: right;
      transition: all 0.3s;
    }
    
    .refresh-btn:hover {
      background: #218838;
    }
    
    .notification-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #dc3545;
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .timeline {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      font-size: 13px;
    }
    
    .timeline div {
      padding: 3px 0;
    }
  </style>
</head>
<body>
  <!-- Delivery Boy Navbar -->
  <div class="delivery-navbar">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2><i class="fas fa-motorcycle"></i> Delivery Portal</h2>
        </div>
        <div class="delivery-info">
          <i class="fas fa-user-circle"></i>
          <div>
            <strong id="deliveryBoyName">Delivery Boy</strong>
            <br>
            <small id="vehicleNumber"></small>
            <button class="logout-btn" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <!-- Status Toggle -->
    <div class="status-toggle">
      <h4>Your Current Status</h4>
      <div class="status-badge" id="currentStatus">Available</div>
      <br>
      <button class="toggle-status-btn" onclick="toggleAvailability()">
        <i class="fas fa-toggle-on"></i> Toggle Availability
      </button>
    </div>

    <!-- Stats Row -->
    <div class="stats-row">
      <div class="stat-card">
        <i class="fas fa-tasks" style="font-size: 36px; color: #6f42c1;"></i>
        <h3 id="activeOrdersCount">0</h3>
        <p>Active Orders</p>
      </div>
      <div class="stat-card">
        <i class="fas fa-check-circle" style="font-size: 36px; color: #28a745;"></i>
        <h3 id="completedOrdersCount">0</h3>
        <p>Completed Today</p>
      </div>
      <div class="stat-card">
        <i class="fas fa-rupee-sign" style="font-size: 36px; color: #ffc107;"></i>
        <h3>â‚¹<span id="todayEarnings">0</span></h3>
        <p>Today's Earnings</p>
      </div>
    </div>

    <!-- Orders Section -->
    <div class="orders-section">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3><i class="fas fa-clipboard-list"></i> My Orders</h3>
        <button class="refresh-btn" onclick="loadOrders()">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
      <div class="clearfix"></div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="showTab('new')">
          <i class="fas fa-bell"></i> New Orders <span id="newOrdersBadge" class="badge badge-danger ml-2">0</span>
        </button>
        <button class="tab" onclick="showTab('active')">
          <i class="fas fa-shipping-fast"></i> Active Deliveries
        </button>
        <button class="tab" onclick="showTab('completed')">
          <i class="fas fa-check-double"></i> Completed
        </button>
        <button class="tab" onclick="showTab('earnings')">
          <i class="fas fa-chart-line"></i> Earnings
        </button>
      </div>

      <!-- New Orders Tab -->
      <div id="newTab" class="tab-content active">
        <div id="newOrdersContainer"></div>
      </div>

      <!-- Active Orders Tab -->
      <div id="activeTab" class="tab-content">
        <div id="activeOrdersContainer"></div>
      </div>

      <!-- Completed Orders Tab -->
      <div id="completedTab" class="tab-content">
        <div id="completedOrdersContainer"></div>
      </div>

      <!-- Earnings Tab -->
      <div id="earningsTab" class="tab-content">
        <div class="earnings-summary text-center">
          <h5>Total Earnings</h5>
          <h3>â‚¹<span id="totalEarnings">0</span></h3>
          <p>Based on completed deliveries</p>
        </div>
        <div id="earningsBreakdown"></div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api';
    let currentDeliveryBoy = null;
    let allOrders = [];
    let isAvailable = true;

    window.onload = function() {
      checkDeliveryBoyLogin();
      loadOrders();
      // Auto-refresh every 30 seconds
      setInterval(loadOrders, 30000);
    };

    function checkDeliveryBoyLogin() {
      const dbData = localStorage.getItem('currentDeliveryBoy');
      if (!dbData) {
        alert('âŒ Please login as delivery boy first!');
        window.location.href = 'index.html';
        return;
      }
      currentDeliveryBoy = JSON.parse(dbData);
      document.getElementById('deliveryBoyName').textContent = currentDeliveryBoy.name;
      document.getElementById('vehicleNumber').textContent = 'ðŸï¸ ' + currentDeliveryBoy.vehicle_number;
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('currentDeliveryBoy');
        window.location.href = 'index.html';
      }
    }

    async function loadOrders() {
      try {
        const response = await fetch(`${API_URL}/deliveryboy/${currentDeliveryBoy.id}/orders`);
        const data = await response.json();
        
        if (data.success) {
          allOrders = data.orders;
          displayOrders();
          updateStats();
        }
      } catch (error) {
        console.error('Error loading orders:', error);
      }
    }

    function displayOrders() {
      const newOrders = allOrders.filter(o => o.delivery_status === 'assigned');
      const activeOrders = allOrders.filter(o => o.delivery_status === 'out_for_delivery');
      const completedOrders = allOrders.filter(o => o.delivery_status === 'delivered');

      displayNewOrders(newOrders);
      displayActiveOrders(activeOrders);
      displayCompletedOrders(completedOrders);
      displayEarnings(completedOrders);

      document.getElementById('newOrdersBadge').textContent = newOrders.length;
    }

    function displayNewOrders(orders) {
      const container = document.getElementById('newOrdersContainer');
      
      if (orders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>No new orders assigned</p>
            <small class="text-muted">Check back later for new deliveries</small>
          </div>
        `;
        return;
      }

      container.innerHTML = orders.map(order => `
        <div class="order-card new-order">
          <div class="notification-badge">${orders.indexOf(order) === 0 ? 'NEW' : ''}</div>
          <div class="order-header">
            <div class="order-id">
              <i class="fas fa-receipt"></i> Order #${order.id}
            </div>
            <span class="order-status status-assigned">Assigned</span>
          </div>

          <div class="customer-info">
            <p><strong><i class="fas fa-user"></i> Customer:</strong> ${order.customer_name}</p>
            <p><strong><i class="fas fa-phone"></i> Phone:</strong> 
              <a href="tel:${order.phone}">${order.phone}</a>
            </p>
            <p><strong><i class="fas fa-map-marker-alt"></i> Address:</strong> ${order.address}</p>
            <p><strong><i class="fas fa-clock"></i> Order Time:</strong> ${formatDateTime(order.created_at)}</p>
          </div>

          <div class="order-items">
            <strong>Items to Deliver:</strong>
            <ul class="mt-2 mb-2">
              ${order.items.map(item => `
                <li>${item.name} x ${item.quantity}</li>
              `).join('')}
            </ul>
            <h5 class="text-success mb-0">Total Amount: â‚¹${order.total}</h5>
          </div>

          <div class="action-buttons">
            <button class="action-btn btn-call" onclick="callCustomer('${order.phone}')">
              <i class="fas fa-phone"></i> Call Customer
            </button>
            <button class="action-btn btn-navigate" onclick="navigateToAddress('${encodeURIComponent(order.address)}')">
              <i class="fas fa-map-marked-alt"></i> Navigate
            </button>
            <button class="action-btn btn-pickup" onclick="markPickedUp(${order.id})">
              <i class="fas fa-check"></i> Picked Up
            </button>
          </div>
        </div>
      `).join('');
    }

    function displayActiveOrders(orders) {
      const container = document.getElementById('activeOrdersContainer');
      
      if (orders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-shipping-fast"></i>
            <p>No active deliveries</p>
          </div>
        `;
        return;
      }

      container.innerHTML = orders.map(order => `
        <div class="order-card delivering">
          <div class="order-header">
            <div class="order-id">
              <i class="fas fa-shipping-fast"></i> Order #${order.id}
            </div>
            <span class="order-status status-delivering">Out for Delivery</span>
          </div>

          <div class="customer-info">
            <p><strong><i class="fas fa-user"></i> Customer:</strong> ${order.customer_name}</p>
            <p><strong><i class="fas fa-phone"></i> Phone:</strong> 
              <a href="tel:${order.phone}">${order.phone}</a>
            </p>
            <p><strong><i class="fas fa-map-marker-alt"></i> Address:</strong> ${order.address}</p>
          </div>

          <div class="order-items">
            <h5 class="text-success mb-0">Collection Amount: â‚¹${order.total}</h5>
          </div>

          <div class="timeline">
            <strong>Timeline:</strong>
            <div>ðŸ“¦ Order Placed: ${formatDateTime(order.created_at)}</div>
            ${order.pickup_time ? `<div>ðŸšš Picked Up: ${formatDateTime(order.pickup_time)}</div>` : ''}
          </div>

          <div class="action-buttons mt-3">
            <button class="action-btn btn-call" onclick="callCustomer('${order.phone}')">
              <i class="fas fa-phone"></i> Call
            </button>
            <button class="action-btn btn-navigate" onclick="navigateToAddress('${encodeURIComponent(order.address)}')">
              <i class="fas fa-directions"></i> Navigate
            </button>
            <button class="action-btn btn-deliver" onclick="markDelivered(${order.id})">
              <i class="fas fa-check-double"></i> Mark Delivered
            </button>
          </div>
        </div>
      `).join('');
    }

    function displayCompletedOrders(orders) {
      const container = document.getElementById('completedOrdersContainer');
      
      if (orders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-check-circle"></i>
            <p>No completed deliveries yet</p>
          </div>
        `;
        return;
      }

      // Show today's completed orders
      const today = new Date().toDateString();
      const todayOrders = orders.filter(o => 
        new Date(o.delivered_time).toDateString() === today
      );

      container.innerHTML = todayOrders.map(order => `
        <div class="delivery-history-item">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6><i class="fas fa-check-circle text-success"></i> Order #${order.id}</h6>
              <p class="mb-1"><strong>Customer:</strong> ${order.customer_name}</p>
              <p class="mb-1"><strong>Amount:</strong> â‚¹${order.total}</p>
              <p class="mb-0 text-muted"><small>Delivered: ${formatDateTime(order.delivered_time)}</small></p>
            </div>
            <div class="text-right">
              <h5 class="text-success mb-0">â‚¹${calculateEarnings(order.total)}</h5>
              <small class="text-muted">Earnings</small>
            </div>
          </div>
        </div>
      `).join('');

      if (todayOrders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-calendar-day"></i>
            <p>No deliveries completed today</p>
          </div>
        `;
      }
    }

    function displayEarnings(completedOrders) {
      const totalEarnings = completedOrders.reduce((sum, order) => 
        sum + calculateEarnings(order.total), 0
      );
      
      document.getElementById('totalEarnings').textContent = totalEarnings;

      // Today's earnings
      const today = new Date().toDateString();
      const todayOrders = completedOrders.filter(o => 
        new Date(o.delivered_time).toDateString() === today
      );
      const todayEarnings = todayOrders.reduce((sum, order) => 
        sum + calculateEarnings(order.total), 0
      );
      
      document.getElementById('todayEarnings').textContent = todayEarnings;

      // Earnings breakdown
      const container = document.getElementById('earningsBreakdown');
      container.innerHTML = `
        <div class="row">
          <div class="col-md-4">
            <div class="stat-card">
              <h5>Today</h5>
              <h3>â‚¹${todayEarnings}</h3>
              <p>${todayOrders.length} deliveries</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stat-card">
              <h5>This Week</h5>
              <h3>â‚¹${totalEarnings}</h3>
              <p>${completedOrders.length} deliveries</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stat-card">
              <h5>Average per Order</h5>
              <h3>â‚¹${completedOrders.length > 0 ? Math.round(totalEarnings / completedOrders.length) : 0}</h3>
              <p>Delivery fee</p>
            </div>
          </div>
        </div>
      `;
    }

    function calculateEarnings(orderTotal) {
      // Assuming 10% of order total as delivery fee (min â‚¹30, max â‚¹100)
      const earnings = Math.min(Math.max(orderTotal * 0.1, 30), 100);
      return Math.round(earnings);
    }

    function updateStats() {
      const activeOrders = allOrders.filter(o => 
        o.delivery_status === 'assigned' || o.delivery_status === 'out_for_delivery'
      );
      
      const today = new Date().toDateString();
      const completedToday = allOrders.filter(o => 
        o.delivery_status === 'delivered' && 
        new Date(o.delivered_time).toDateString() === today
      );

      document.getElementById('activeOrdersCount').textContent = activeOrders.length;
      document.getElementById('completedOrdersCount').textContent = completedToday.length;

      // Update status badge
      const currentOrders = activeOrders.length;
      const statusBadge = document.getElementById('currentStatus');
      if (currentOrders > 0) {
        statusBadge.textContent = 'Busy';
        statusBadge.className = 'status-badge status-busy';
        isAvailable = false;
      } else {
        statusBadge.textContent = 'Available';
        statusBadge.className = 'status-badge status-available';
        isAvailable = true;
      }
    }

    async function markPickedUp(orderId) {
      if (!confirm('Confirm that you have picked up this order?')) return;

      try {
        const response = await fetch(`${API_URL}/deliveryboy/pickup-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            order_id: orderId,
            delivery_boy_id: currentDeliveryBoy.id
          })
        });

        const data = await response.json();
        if (data.success) {
          alert('âœ… Order marked as picked up!');
          await loadOrders();
          showTab('active');
        } else {
          alert('âŒ ' + data.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('âŒ Failed to update order status!');
      }
    }

    async function markDelivered(orderId) {
      if (!confirm('Confirm that this order has been delivered to the customer?')) return;

      try {
        const response = await fetch(`${API_URL}/deliveryboy/deliver-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            order_id: orderId,
            delivery_boy_id: currentDeliveryBoy.id
          })
        });

        const data = await response.json();
        if (data.success) {
          const order = allOrders.find(o => o.id === orderId);
          const earnings = calculateEarnings(order.total);
          alert(`ðŸŽ‰ Order delivered successfully!\n\nYour earnings: â‚¹${earnings}`);
          await loadOrders();
          showTab('completed');
        } else {
          alert('âŒ ' + data.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('âŒ Failed to update order status!');
      }
    }

    function callCustomer(phone) {
      window.location.href = 'tel:' + phone;
    }

    function navigateToAddress(address) {
      // Open Google Maps with the address
      const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${address}`;
      window.open(mapsUrl, '_blank');
    }

    function toggleAvailability() {
      const activeOrders = allOrders.filter(o => 
        o.delivery_status === 'assigned' || o.delivery_status === 'out_for_delivery'
      );

      if (activeOrders.length > 0) {
        alert('âš ï¸ You cannot change availability while you have active orders!');
        return;
      }

      isAvailable = !isAvailable;
      const statusBadge = document.getElementById('currentStatus');
      
      if (isAvailable) {
        statusBadge.textContent = 'Available';
        statusBadge.className = 'status-badge status-available';
        alert('âœ… You are now available for deliveries!');
      } else {
        statusBadge.textContent = 'Offline';
        statusBadge.className = 'status-badge status-busy';
        alert('âš ï¸ You are now offline. You will not receive new orders.');
      }
    }

    function showTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(tabName + 'Tab').classList.add('active');
    }

    function formatDateTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('en-IN', {
        day: '2-digit',
        month: 'short',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
  </script>
</body>
</html>